<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Flappy Jack (Responsive)</title>
  <style>
    /*
     * CSS Responsive - S·ª≠ d·ª•ng t·ª∑ l·ªá ph·∫ßn trƒÉm v√† viewport
     */
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      /* NgƒÉn cu·ªôn tr√™n thi·∫øt b·ªã di ƒë·ªông */
      touch-action: manipulation;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image: radial-gradient(white 1px, transparent 1px);
      background-size: 4px 4px;
      z-index: 0;
    }

    #container {
      /* D√πng viewport unit ƒë·ªÉ game chi·∫øm t·ª∑ l·ªá m√†n h√¨nh */
      /* Chi·ªÅu r·ªông t·ªëi ƒëa 400px, nh∆∞ng ∆∞u ti√™n 80vw */
      width: clamp(280px, 80vw, 400px);
      /* T·ª∑ l·ªá 3:2, chi·ªÅu cao s·∫Ω l√† 1.5 l·∫ßn chi·ªÅu r·ªông */
      aspect-ratio: 2 / 3;
      position: absolute; /* Thay th·∫ø relative/margin auto b·∫±ng absolute + translate ƒë·ªÉ cƒÉn gi·ªØa t·ªët h∆°n */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 4px solid white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 30px white;
      background-color: black;
      z-index: 1;
    }

    #game {
      width: 100%;
      height: 100%;
      position: relative;
    }

    /* C√°c ph·∫ßn t·ª≠ trong game s·∫Ω d√πng % ƒë·ªÉ t√≠nh theo k√≠ch th∆∞·ªõc #game */
    #bird {
      position: absolute;
      /* T·ªça ƒë·ªô ban ƒë·∫ßu v√† k√≠ch th∆∞·ªõc d√πng % */
      left: 15%; /* 60px / 400px */
      top: 33.33%; /* 200px / 600px */
      width: 15%; /* 60px / 400px */
      height: 10%; /* 60px / 600px */
      z-index: 3;
    }

    #bird img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .pipe {
      position: absolute;
      width: 15%; /* 60px / 400px */
      box-shadow: 0 0 10px white;
      border: 2px solid white;
      z-index: 2;
    }

    #menu, #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      z-index: 4;
      /* K√≠ch th∆∞·ªõc ch·ªØ c≈©ng n√™n d√πng ƒë∆°n v·ªã linh ho·∫°t */
      font-size: clamp(14px, 4vw, 24px);
      width: 80%;
    }

    button {
      padding: 12px 24px;
      margin-top: 20px;
      font-size: clamp(16px, 4vw, 18px); /* K√≠ch th∆∞·ªõc ch·ªØ button linh ho·∫°t */
      background: linear-gradient(to right, #00f2ff, #8e44ad);
      color: white;
      border: none;
      border-radius: 8px;
      box-shadow: 0 0 10px #00f2ff;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    #skin-selector {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
      padding: 6px;
      border-radius: 6px;
      font-size: clamp(12px, 3vw, 16px);
    }

    #score-display {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      font-size: clamp(14px, 4vw, 18px);
      background: rgba(0, 0, 0, 0.6);
      padding: 6px 12px;
      border-radius: 8px;
      z-index: 5;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <select id="skin-selector">
    <option value="https://i.postimg.cc/RCNbLPc7/Messenger-creation-4-AE4-FBB8-C576-4325-BBE1-D42378827178-removebg-preview.png">üêù Ru·ªìi 97</option>
    <option value="https://i.postimg.cc/1tQ2KYkR/Picsart-25-07-27-17-40-01-016.png">üê∞ Th·ªè 7 M√†u Tr·∫Øng</option>
    <option value="https://i.postimg.cc/3xKMMw9j/Picsart-25-07-27-18-41-47-416.png">ü¶† Vi-R√∫t :))</option>
  </select>

  <div id="container">
    <div id="game">
      <div id="bird">
        <img id="bird-img" src="https://i.postimg.cc/RCNbLPc7/Messenger-creation-4-AE4-FBB8-C576-4325-BBE1-D42378827178-removebg-preview.png" alt="Bird">
      </div>

      <div id="menu">
        <h1>Flappy Jack</h1>
        <button onclick="startGame()">B·∫Øt ƒë·∫ßu ch∆°i</button>
      </div>

      <div id="game-over" class="hidden">
        <h2>üíÄ Ngu Ch√©t R·ªìi</h2>
        <p>ƒêi·ªÉm: <span id="final-score">0</span></p>
        <button onclick="restartGame()">Ch∆°i l·∫°i</button>
      </div>

      <div id="score-display">ƒêi·ªÉm: 0 | üèÜ K·ª∑ l·ª•c: 0</div>
    </div>
  </div>

  <script>
    // ƒê·ªãnh nghƒ©a k√≠ch th∆∞·ªõc tham chi·∫øu (Base size)
    // Coi 400x600 l√† k√≠ch th∆∞·ªõc chu·∫©n ƒë·ªÉ t√≠nh to√°n t·ª∑ l·ªá
    const BASE_WIDTH = 400;
    const BASE_HEIGHT = 600;

    function playFlapSound() {
      const sound = new Audio("https://media.vocaroo.com/mp3/1cjtI3SDssfx");
      sound.volume = 0.5;
      sound.play();
    }

    const container = document.getElementById("container");
    const game = document.getElementById("game");
    const bird = document.getElementById("bird");
    const gameOverMenu = document.getElementById("game-over");
    const menu = document.getElementById("menu");
    const finalScore = document.getElementById("final-score");
    const scoreDisplay = document.getElementById("score-display");

    // Bi·∫øn tr·∫°ng th√°i
    let birdTop = 200; // V·∫´n d√πng gi√° tr·ªã pixel g·ªëc ƒë·ªÉ t√≠nh to√°n
    let gravity = 2;
    let flapStrength = 45;
    let pipeSpeed = 2;
    let isGameOver = false;
    let pipes = [];
    let score = 0;
    let highScore = localStorage.getItem("flappyHighScore") || 0;
    let gameLoop;
    const gapBase = 180; // Kho·∫£ng c√°ch khe h·ªü g·ªëc (pixel)
    let lastPipeX = BASE_WIDTH;
    const pipeSpacingBase = 220; // Kho·∫£ng c√°ch gi·ªØa c√°c ·ªëng (pixel)

    // H√†m l·∫•y t·ª∑ l·ªá chuy·ªÉn ƒë·ªïi
    function getScale() {
      const gameWidth = game.clientWidth;
      const gameHeight = game.clientHeight;
      // L·∫•y t·ª∑ l·ªá chi·ªÅu r·ªông, d√πng ƒë·ªÉ chuy·ªÉn ƒë·ªïi c√°c gi√° tr·ªã X
      const scaleX = gameWidth / BASE_WIDTH;
      // L·∫•y t·ª∑ l·ªá chi·ªÅu cao, d√πng ƒë·ªÉ chuy·ªÉn ƒë·ªïi c√°c gi√° tr·ªã Y
      const scaleY = gameHeight / BASE_HEIGHT;
      // D√πng scaleY cho t·∫•t c·∫£ gi√° tr·ªã v√¨ BirdTop, Gravity, Flap, PipeHeight ƒë·ªÅu ·∫£nh h∆∞·ªüng b·ªüi chi·ªÅu cao game
      return { scaleX, scaleY };
    }

    function getRandomColor() {
      const colors = ['#ff0055', '#00ffee', '#00ff33', '#ffaa00', '#cc00ff', '#00aaff'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function updateScoreDisplay() {
      scoreDisplay.textContent = `ƒêi·ªÉm: ${score} | üèÜ K·ª∑ l·ª•c: ${highScore}`;
    }

    function startGame() {
      menu.classList.add("hidden");
      
      // Kh·ªüi t·∫°o v·ªã tr√≠ bird theo t·ª∑ l·ªá chi·ªÅu cao m·ªõi
      const { scaleY } = getScale();
      birdTop = 200 * scaleY; // Chuy·ªÉn ƒë·ªïi v·ªã tr√≠ kh·ªüi ƒë·∫ßu 200px
      bird.style.top = (birdTop / scaleY) * 100 / BASE_HEIGHT + "%"; // ƒê·∫∑t l·∫°i v·ªã tr√≠ theo %
      
      isGameOver = false;
      score = 0;
      finalScore.textContent = "0";
      updateScoreDisplay();
      pipes.forEach(p => {
        game.removeChild(p.top);
        game.removeChild(p.bottom);
      });
      pipes = [];
      gameOverMenu.classList.add("hidden");

      gameLoop = setInterval(gameLogic, 20);
    }

    function gameLogic() {
      const { scaleX, scaleY } = getScale();
      const scaledGravity = gravity * scaleY;
      const scaledPipeSpeed = pipeSpeed * scaleX;
      const scaledGap = gapBase * scaleY;
      const scaledPipeSpacing = pipeSpacingBase * scaleX;

      // 1. C·∫≠p nh·∫≠t v·ªã tr√≠ Bird
      birdTop += scaledGravity;
      // ƒê·∫∑t l·∫°i v·ªã tr√≠ Bird theo t·ª∑ l·ªá % ƒë·ªÉ Bird lu√¥n ·ªü ƒë√∫ng v·ªã tr√≠ tr√™n m√†n h√¨nh
      // birdTop hi·ªán t·∫°i l√† gi√° tr·ªã ƒë√£ scale, ph·∫£i chia l·∫°i cho scaleY ƒë·ªÉ l·∫•y gi√° tr·ªã base (t∆∞∆°ng ƒë∆∞∆°ng pixel g·ªëc)
      // sau ƒë√≥ chia cho chi·ªÅu cao game g·ªëc (600) r·ªìi * 100 ƒë·ªÉ c√≥ %
      bird.style.top = (birdTop / scaleY) * 100 / BASE_HEIGHT + "%";

      // 2. T·∫°o ·ªêng m·ªõi
      if (!isGameOver && (pipes.length === 0 || pipes[pipes.length - 1].left < BASE_WIDTH - scaledPipeSpacing)) {
          generatePipe();
      }

      // 3. C·∫≠p nh·∫≠t v·ªã tr√≠ ·ªêng v√† Ki·ªÉm tra va ch·∫°m
      pipes.forEach((pipe, index) => {
          pipe.left -= scaledPipeSpeed;
          // Chuy·ªÉn ƒë·ªïi pipe.left ƒë√£ scale (t∆∞∆°ng ƒë∆∞∆°ng pixel g·ªëc) sang % ƒë·ªÉ ƒë·∫∑t v·ªã tr√≠
          pipe.top.style.left = (pipe.left / scaleX) * 100 / BASE_WIDTH + "%";
          pipe.bottom.style.left = (pipe.left / scaleX) * 100 / BASE_WIDTH + "%";

          // K√≠ch th∆∞·ªõc chim (Bird) v√† ·ªëng (Pipe) ƒë√£ chuy·ªÉn sang % trong CSS
          // C·∫ßn chuy·ªÉn ƒë·ªïi c√°c gi√° tr·ªã base/c·ªë ƒë·ªãnh sang gi√° tr·ªã ƒë√£ scale
          const BIRD_LEFT_POS = 60 * scaleX; // 60px base
          const BIRD_WIDTH = 60 * scaleX; // 60px base
          const PIPE_WIDTH = 60 * scaleX; // 60px base
          const BIRD_HEIGHT = 60 * scaleY; // 60px base (x·∫•p x·ªâ 10% chi·ªÅu cao)

          // Va ch·∫°m X: Bird (BIRD_LEFT_POS) ch·∫°m ·ªëng (pipe.left)
          // Va ch·∫°m Y: Bird (birdTop) ch·∫°m ·ªëng tr√™n (pipe.scaledHeight) ho·∫∑c ·ªëng d∆∞·ªõi
          if (
              pipe.left < BIRD_LEFT_POS + BIRD_WIDTH && pipe.left + PIPE_WIDTH > BIRD_LEFT_POS &&
              (birdTop < pipe.scaledHeight || birdTop + BIRD_HEIGHT * 0.9 > pipe.scaledHeight + scaledGap)
              // *0.9 l√† m·ªôt ƒëi·ªÅu ch·ªânh nh·ªè ƒë·ªÉ tr√°nh va ch·∫°m qu√° nh·∫°y (t√πy ch·ªânh)
          ) {
              endGame();
          }

          // T√≠nh ƒëi·ªÉm (khi ·ªëng v∆∞·ª£t qua Bird)
          if (pipe.left + PIPE_WIDTH < BIRD_LEFT_POS && !pipe.counted) {
              score++;
              pipe.counted = true;
              if (score > highScore) {
                  highScore = score;
                  localStorage.setItem("flappyHighScore", highScore);
              }
              updateScoreDisplay();
          }

          // X√≥a ·ªëng kh·ªèi b·ªô nh·ªõ (khi ·ªëng ƒëi ra kh·ªèi m√†n h√¨nh)
          if (pipe.left < -PIPE_WIDTH) {
              game.removeChild(pipe.top);
              game.removeChild(pipe.bottom);
              pipes.splice(index, 1);
          }
      });

      // 4. Va ch·∫°m bi√™n (tr√™n/d∆∞·ªõi)
      if (birdTop > game.clientHeight || birdTop < 0) {
          endGame();
      }
    }

    function generatePipe() {
      if (isGameOver) return;

      const { scaleY } = getScale();
      const scaledGap = gapBase * scaleY;

      // T√≠nh chi·ªÅu cao ·ªëng tr√™n (base)
      let pipeHeightBase = Math.floor(Math.random() * 250) + 50;
      // Chuy·ªÉn sang gi√° tr·ªã ƒë√£ scale
      let pipeHeightScaled = pipeHeightBase * scaleY;

      let color = getRandomColor();

      let pipeTop = document.createElement("div");
      pipeTop.className = "pipe";
      pipeTop.style.background = color;
      
      // ƒê·∫∑t chi·ªÅu cao v√† v·ªã tr√≠ theo %
      pipeTop.style.height = pipeHeightBase * 100 / BASE_HEIGHT + "%";
      pipeTop.style.top = "0";
      pipeTop.style.left = "100%"; // B·∫Øt ƒë·∫ßu t·ª´ ngo√†i bi√™n 100%

      let pipeBottom = document.createElement("div");
      pipeBottom.className = "pipe";
      pipeBottom.style.background = color;
      
      // ƒê·∫∑t chi·ªÅu cao ·ªëng d∆∞·ªõi theo %
      let bottomHeightBase = BASE_HEIGHT - pipeHeightBase - gapBase;
      pipeBottom.style.height = bottomHeightBase * 100 / BASE_HEIGHT + "%";
      pipeBottom.style.bottom = "0";
      pipeBottom.style.left = "100%";

      game.appendChild(pipeTop);
      game.appendChild(pipeBottom);

      pipes.push({
        top: pipeTop,
        bottom: pipeBottom,
        left: BASE_WIDTH, // V·∫´n d√πng gi√° tr·ªã base cho `left` ƒë·ªÉ d·ªÖ d√†ng t√≠nh to√°n trong gameLogic
        height: pipeHeightBase, // Chi·ªÅu cao base
        scaledHeight: pipeHeightScaled, // Chi·ªÅu cao ƒë√£ scale
        counted: false
      });

      lastPipeX = BASE_WIDTH;
    }

    function endGame() {
      clearInterval(gameLoop);
      isGameOver = true;
      finalScore.textContent = score;
      updateScoreDisplay();
      gameOverMenu.classList.remove("hidden");
    }

    function restartGame() {
      startGame();
    }

    // X·ª≠ l√Ω s·ª± ki·ªán nh·∫•n/ch·∫°m
    function handleFlap() {
      if (!isGameOver) {
        const { scaleY } = getScale();
        const scaledFlap = flapStrength * scaleY;
        birdTop -= scaledFlap;
        playFlapSound();
      }
    }

    document.addEventListener("keydown", handleFlap);
    document.addEventListener("touchstart", handleFlap);

    // ‚úÖ Thay skin
    document.getElementById("skin-selector").addEventListener("change", function () {
      document.getElementById("bird-img").src = this.value;
    });

    // Hi·ªÉn th·ªã ƒëi·ªÉm ngay t·ª´ ƒë·∫ßu
    updateScoreDisplay();
  </script>

</body>
</html>
